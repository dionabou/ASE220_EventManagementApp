<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizer Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
      .event-img {
        width: 100%;       
        height: 300px;    
        object-fit: cover; 
      }
      .star {
          font-size: 1.5rem;
          cursor: pointer;
          color: lightgray;
      }
      .star.filled {
          color: gold;
      }
      .favorite {
          font-size: 1.5rem;
          cursor: pointer;
      }
      .favorite.active {
          color: red;
      }
      .share {
          font-size: 1.5rem;
          cursor: pointer;
          color: #007bff;
      }
      .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          background: #28a745;
          color: white;
          padding: 15px;
          border-radius: 5px;
          display: none;
          z-index: 1000;
      }
      #details-image {
          width: 100%;
          height: 30em;
          object-fit: cover;
          margin: auto;
          margin-top: 2%;
          border-radius: 3em;
      }
      .card {
          display: block;
          width: 100%;
          height: 100%;
          border-width: 2px;
      }
    </style>
</head>
<body>
  <div class="container my-4">
    <h1 class="text-center mb-4">Manage Your Events</h1>

 
    <div class="text-center mb-3">
      <button id="btn-createEvent" class="btn btn-success">Create a New Event</button>
    </div>

   
    <div id="frmNewEventContainer" class="d-none">
      <h2 class="mb-3">Add an Event</h2>
      <form id="frmCreateEvent">
        <div class="row">
          <div class="col-md-6 mb-2">
            <label for="eventName" class="form-label"><strong>Event Name</strong></label>
            <input type="text" id="eventName" class="form-control" required>
          </div>
          <div class="col-md-6 mb-2">
            <label for="eventType" class="form-label"><strong>Type of Event</strong></label>
            <input type="text" id="eventType" class="form-control" required>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 mb-2">
            <label for="eventDate" class="form-label"><strong>Date & Time</strong></label>
            <input type="datetime-local" id="eventDate" class="form-control" required>
          </div>
          <div class="col-md-4 mb-2">
            <label for="eventLocation" class="form-label"><strong>Location</strong></label>
            <input type="text" id="eventLocation" class="form-control" required>
          </div>
          <div class="col-md-4 mb-2">
            <label for="eventCapacity" class="form-label"><strong>Max Attendees</strong></label>
            <input type="number" id="eventCapacity" class="form-control" required>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 mb-2">
            <label for="eventPrice" class="form-label"><strong>Price ($)</strong></label>
            <input type="number" step ="0.01" id="eventPrice" class="form-control" required>
          </div>
          <div class="col-md-8 mb-2">
            <label for="eventDescription" class="form-label"><strong>Description</strong></label>
            <textarea id="eventDescription" class="form-control" rows="3" required></textarea>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 mb-2">
            <label for="eventImage" class="form-label"><strong>Image URL</strong></label>
            <input type="url" id="eventImage" class="form-control" placeholder="Enter image URL" required>
          </div>
        </div>
        <div class="text-center">
          <button type="submit" class="btn btn-primary">Save Event</button>
          <button type="button" id="cancelEventCreation" class="btn btn-danger">Cancel</button>
        </div>
      </form>
    </div>


    <div class="row row-cols-1 row-cols-md-3 g-4 mt-4" id="event-container"></div>

    <div class="text-center my-4">
      <button id="load-more" class="btn btn-primary">Load More</button>
    </div>
  </div>

  <!--Modal to show event details-->
  <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModal" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="detailsModal">Event Details</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="row">
                <img id="details-image" src="">
            </div>
            <hr>
            <div class="row p-2 justify-content-between">
                <div class="col">
                  <h1 id="detailsEventName">Event Title</h1>
                </div>
                <div class="col-2"></div>
                <div class="col-3">
                  <p id="detailsPrice" class="fs-5">Price</p>
                </div>
            </div>
            <hr>
            <div class="row p-2 justify-content-between">
                <div class="col">
                    <h3 id="detailsLocation" class="text-secondary-emphasis">Location:</h3>
                </div>
                <div class="col-3">
                    <h5 id="detailsCapacity" class="text-secondary-emphasis">Capacity:</h5>
                </div>
            </div>
            <div class="row">
                <p id="detailsDescription" class="text-secondary fs-5 m-2">Event Description</h2>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary register-event" data-id="${event.id}">Register</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const storage_url = "https://jsonblob.com/api/1345098910003290112"; 
    let events = [];

    const eventContainer = document.getElementById("event-container");
    const btnCreateEvent = document.getElementById("btn-createEvent");
    const frmNewEventContainer = document.getElementById("frmNewEventContainer");
    const frmCreateEvent = document.getElementById("frmCreateEvent");
    const cancelEventCreation = document.getElementById("cancelEventCreation");

    btnCreateEvent.addEventListener("click", () => {
      frmNewEventContainer.classList.remove("d-none");
    });

    cancelEventCreation.addEventListener("click", () => {
      frmNewEventContainer.classList.add("d-none");
      frmCreateEvent.reset();
    });

    async function fetchEvents() {
      try {
          const response = await fetch(storage_url);
          let data = await response.json();
          events = data.filter(item => item.id && item.name && item.image);
          renderEvents();
      } catch (error) {
          console.error("Error fetching events:", error);
      }
    }

    frmCreateEvent.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const newEvent = {
        id: events.length + 1,
        name: document.getElementById("eventName").value,
        type: document.getElementById("eventType").value,
        date: document.getElementById("eventDate").value,
        location: document.getElementById("eventLocation").value,
        capacity: document.getElementById("eventCapacity").value,
        price: document.getElementById("eventPrice").value,
        description: document.getElementById("eventDescription").value,
        image: document.getElementById("eventImage").value
      };

      events.push(newEvent);
      await saveEventsToJSONBlob();
      renderEvents();
      frmNewEventContainer.classList.add("d-none");
      frmCreateEvent.reset();
    });

    async function saveEventsToJSONBlob() {
      await fetch(storage_url, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(events)
      });
    }

    function renderEvents(filter = "") {
      eventContainer.innerHTML = events
          .filter(event => event.name.toLowerCase().includes(filter.toLowerCase()))
          .map(createEventCard)
          .join("");
    }

    function createEventCard(event) {
      return `
        <div class="col-md-4 mb-4">
          <div class="card">
            <img src="${event.image}" class="card-img-top event-img" alt="${event.name}">
            <div class="card-body">
              <h4 class="card-title">${event.name}</h4>
              <p><strong>Type:</strong> ${event.type}</p>
              <p><strong>Date:</strong> ${event.date}</p>
              <p><strong>Location:</strong> ${event.location}</p>
              <p><strong>Price:</strong> $${event.price}</p>
              <button class="btn btn-info view-details" id="${event.id}" onclick='setDetailModal(this.id)'>View Details</button>
              <button class="btn btn-warning edit-event">Edit</button>
              <button class="btn btn-danger delete-event" id="${event.id}" onclick='deleteEvent(this.id)'>Delete</button>
            </div>
          </div>
        </div>
      `;
    }


    fetchEvents();

    // Shows the event detail modal
    function showDetailModal(){
      var modal = new bootstrap.Modal(document.getElementById('detailsModal'));
      modal.show();
    }

    // Gets JSON data for use in the modal
    async function getDetailData() {
      try {
          const response = await fetch(storage_url);
          const data = await response.json();
          return data;
      } catch (error) {
          console.error('Error fetching data:', error);
          return null;
      }
    }

    // Sets modal text to JSON data
    async function setDetailModal(buttonId){
      const eventId = Number(buttonId); 
      var detailData = await getDetailData();
      if (!detailData) {
          console.error("Failed to fetch data.");
          return;
      }
      const event = detailData.find(item => item.id === eventId);
      if (event) {
          document.getElementById('detailsEventName').innerHTML = `${event.name}`;
          document.getElementById('detailsLocation').innerHTML = `${event.location}`;
          document.getElementById('detailsDescription').innerHTML = `${event.description}`;
          document.getElementById('details-image').src = `${event.image}`;
          document.getElementById('detailsPrice').innerHTML = `Entry Price:<br><span class="fs-3">$${event.price}</span>`;
          document.getElementById('detailsCapacity').innerHTML = `Capacity: ${event.capacity}`;
      } else {
          console.log("Event not found");
      }

      // Show modal
      showDetailModal();
    }

    async function deleteEvent(buttonId){
      const eventId = Number(buttonId); 
      var data = await getDetailData();
      const event = data.find(item => item.id === eventId);
      data = data.filter(item => item.id !== event.id);
      console.log(JSON.stringify(data));
      await fetch(storage_url, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      fetchEvents();
    }
  </script>
</body>
</html>
