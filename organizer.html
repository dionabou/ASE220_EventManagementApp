<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizer Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
      .event-img {
        width: 100%;       
        height: 300px;    
        object-fit: cover; 
      }
      .star {
          font-size: 1.5rem;
          cursor: pointer;
          color: lightgray;
      }
      .star.filled {
          color: gold;
      }
      .favorite {
          font-size: 1.5rem;
          cursor: pointer;
      }
      .favorite.active {
          color: red;
      }
      .share {
          font-size: 1.5rem;
          cursor: pointer;
          color: #007bff;
      }
      .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          background: #28a745;
          color: white;
          padding: 15px;
          border-radius: 5px;
          display: none;
          z-index: 1000;
      }
      #details-image {
          width: 100%;
          height: 30em;
          object-fit: cover;
          margin: auto;
          margin-top: 2%;
          border-radius: 3em;
      }
      .card {
          display: block;
          width: 100%;
          height: 100%;
          border-width: 2px;
      }
    </style>
</head>
<body>
  <div class="container my-4">
    <h1 class="text-center mb-4">Manage Events</h1>

    <div class="text-center mb-3">
      <button id="btn-createEvent" class="btn btn-success">Create a New Event</button>
    </div>

    <div id="frmNewEventContainer" class="d-none">
      <h2 class="mb-3">Add or Edit an Event</h2>
      <form id="frmCreateEvent">
        <div class="row">
          <div class="col-md-6 mb-2">
            <label for="eventName" class="form-label"><strong>Event Name</strong></label>
            <input type="text" id="eventName" class="form-control" required>
          </div>
          <div class="col-md-6 mb-2">
            <label for="eventType" class="form-label"><strong>Type of Event</strong></label>
            <input type="text" id="eventType" class="form-control" required>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 mb-2">
            <label for="eventDate" class="form-label"><strong>Date & Time</strong></label>
            <input type="datetime-local" id="eventDate" class="form-control" required>
          </div>
          <div class="col-md-4 mb-2">
            <label for="eventLocation" class="form-label"><strong>Location</strong></label>
            <input type="text" id="eventLocation" class="form-control" required>
          </div>
          <div class="col-md-4 mb-2">
            <label for="eventCapacity" class="form-label"><strong>Max Attendees</strong></label>
            <input type="number" id="eventCapacity" class="form-control" required>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 mb-2">
            <label for="eventPrice" class="form-label"><strong>Price ($)</strong></label>
            <input type="number" step="0.01" id="eventPrice" class="form-control" required>
          </div>
          <div class="col-md-8 mb-2">
            <label for="eventDescription" class="form-label"><strong>Description</strong></label>
            <textarea id="eventDescription" class="form-control" rows="3" required></textarea>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 mb-2">
            <label for="eventImage" class="form-label"><strong>Image URL</strong></label>
            <input type="url" id="eventImage" class="form-control" placeholder="Enter image URL" required>
          </div>
        </div>
        <div class="text-center">
          <button type="submit" class="btn btn-primary">Save Event</button>
          <button type="button" id="cancelEventCreation" class="btn btn-danger">Cancel</button>
        </div>
      </form>
    </div>

    <h2>Your Events</h2>
    <div class="row row-cols-1 row-cols-md-3 g-4 mt-4" id="created-event-container"></div>

    <hr class="m-5">

    <h2>Other Events</h2>
    <div class="row row-cols-1 row-cols-md-3 g-4 mt-4" id="event-container"></div>

    <div class="text-center my-4">
      <button id="load-more" class="btn btn-primary">Load More</button>
    </div>
  </div>

  <!-- Modal to show event details -->
  <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModal" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="detailsModal">Event Details</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="row">
                <img id="details-image" src="">
            </div>
            <hr>
            <div class="row p-2 justify-content-between">
                <div class="col">
                  <h1 id="detailsEventName">Event Title</h1>
                </div>
                <div class="col-2"></div>
                <div class="col-3">
                  <p id="detailsPrice" class="fs-5">Price</p>
                </div>
            </div>
            <hr>
            <div class="row p-2 justify-content-between">
                <div class="col">
                    <h3 id="detailsLocation" class="text-secondary-emphasis">Location:</h3>
                </div>
                <div class="col-3">
                    <h5 id="detailsCapacity" class="text-secondary-emphasis">Capacity:</h5>
                </div>
            </div>
            <div class="row">
                <p id="detailsDescription" class="text-secondary fs-5 m-2">Event Description</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary register-event" data-id="${event.id}">Register</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const storage_url = "https://jsonblob.com/api/1345098910003290112"; 
    let events = [];

    const eventContainer = document.getElementById("event-container");
    const createdEventContainer = document.getElementById("created-event-container");
    const btnCreateEvent = document.getElementById("btn-createEvent");
    const frmNewEventContainer = document.getElementById("frmNewEventContainer");
    const frmCreateEvent = document.getElementById("frmCreateEvent");
    const cancelEventCreation = document.getElementById("cancelEventCreation");

    btnCreateEvent.addEventListener("click", () => {
      frmNewEventContainer.classList.remove("d-none");
    });

    cancelEventCreation.addEventListener("click", () => {
      frmNewEventContainer.classList.add("d-none");
      frmCreateEvent.reset();
    });

    async function fetchEvents() {
      try {
          const response = await fetch(storage_url);
          let data = await response.json();
          events = data.filter(item => item.id && item.name && item.image);
          renderEvents();
      } catch (error) {
          console.error("Error fetching events:", error);
      }
    }

    frmCreateEvent.addEventListener("submit", async (e) => {
      e.preventDefault();

      const response = await fetch(storage_url);
      let data = await response.json();
      events = data.filter(item => item.id && item.name && item.image);

      const newEvent = {
        id: events.length + 1,
        name: document.getElementById("eventName").value,
        type: document.getElementById("eventType").value,
        date: document.getElementById("eventDate").value,
        location: document.getElementById("eventLocation").value,
        capacity: document.getElementById("eventCapacity").value,
        price: document.getElementById("eventPrice").value,
        description: document.getElementById("eventDescription").value,
        image: document.getElementById("eventImage").value
      };

      data.push(newEvent);
      await saveEventsToJSONBlob(data);

      frmNewEventContainer.classList.add("d-none");
      frmCreateEvent.reset();
      renderEvents();
    });

    async function saveEventsToJSONBlob(toSave) {
      await fetch(storage_url, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(toSave)
      });
    }

    function renderEvents() {
      createdEventContainer.innerHTML = events.map(createUserEventCard).join("");
      eventContainer.innerHTML = events.map(createOtherEventCard).join("");
    }

    function createUserEventCard(event) {
      return `
        <div class="col-md-4 mb-4">
          <div class="card">
            <img src="${event.image}" class="card-img-top event-img" alt="${event.name}">
            <div class="card-body">
              <h4 class="card-title">${event.name}</h4>
              <p><strong>Type:</strong> ${event.type}</p>
              <p><strong>Date:</strong> ${event.date}</p>
              <p><strong>Location:</strong> ${event.location}</p>
              <p><strong>Price:</strong> $${event.price}</p>
              <button class="btn btn-info view-details" id="${event.id}" onclick='setDetailModal(this.id)'>View Details</button>
              <button class="btn btn-warning" onclick="editEvent(${event.id})">Edit</button>
              <button class="btn btn-danger delete-event" id="${event.id}" onclick='deleteEvent(this.id)'>Delete</button>
            </div>
          </div>
        </div>
      `;
    }

    function editEvent(eventId) {
      const event = events.find(event => event.id === eventId);
      if (!event) return;

      document.getElementById("eventName").value = event.name;
      document.getElementById("eventType").value = event.type;
      document.getElementById("eventDate").value = event.date;
      document.getElementById("eventLocation").value = event.location;
      document.getElementById("eventCapacity").value = event.capacity;
      document.getElementById("eventPrice").value = event.price;
      document.getElementById("eventDescription").value = event.description;
      document.getElementById("eventImage").value = event.image;

      frmNewEventContainer.classList.remove("d-none");
      const saveButton = document.querySelector("#frmCreateEvent button[type='submit']");
      saveButton.textContent = "Update Event";
      saveButton.onclick = async (e) => {
        e.preventDefault();
        
        event.name = document.getElementById("eventName").value;
        event.type = document.getElementById("eventType").value;
        event.date = document.getElementById("eventDate").value;
        event.location = document.getElementById("eventLocation").value;
        event.capacity = document.getElementById("eventCapacity").value;
        event.price = document.getElementById("eventPrice").value;
        event.description = document.getElementById("eventDescription").value;
        event.image = document.getElementById("eventImage").value;

        await saveEventsToJSONBlob(events);
        frmNewEventContainer.classList.add("d-none");
        frmCreateEvent.reset();
        renderEvents();
      };
    }

    fetchEvents();
	

function deleteEvent(eventId) {
  if (confirm("Are you sure you want to delete this event?")) {
    const eventIdNum = parseInt(eventId);
    
    const eventIndex = events.findIndex(event => event.id === eventIdNum);
    
    if (eventIndex !== -1) {
      events.splice(eventIndex, 1);
      
      saveEventsToJSONBlob(events).then(() => {
        renderEvents();
        alert("Event deleted successfully!");
      });
    } else {
      alert("Event not found!");
    }
  }
}

function setDetailModal(buttonId) {
  const eventId = parseInt(buttonId);
  const event = events.find(e => e.id === eventId);
  
  if (event) {
    document.getElementById('detailsEventName').textContent = event.name;
    document.getElementById('detailsLocation').textContent = event.location;
    document.getElementById('detailsDescription').textContent = event.description || "No description available.";
    document.getElementById('details-image').src = event.image;
    document.getElementById('detailsPrice').innerHTML = `Entry Price: $${event.price}`;
    document.getElementById('detailsCapacity').textContent = `Capacity: ${event.capacity}`;
    
    const registerBtn = document.querySelector('.modal-footer .register-event');
    registerBtn.setAttribute('data-id', event.id);
    
    const detailsModal = new bootstrap.Modal(document.getElementById('detailsModal'));
    detailsModal.show();
  } else {
    console.error("Event not found with ID:", eventId);
  }
}

document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.register-event').forEach(button => {
    button.addEventListener('click', function() {
      const eventId = this.getAttribute('data-id');
      alert(`Registration functionality for event ${eventId} would go here`);
    });
  });
});
  </script>
</body>
</html>
